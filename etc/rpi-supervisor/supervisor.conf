# ============================================================
# Rpi Supervisor Configuration
# ============================================================
# Location: /etc/rpi-supervisor/supervisor.conf
# Format: INI
# ============================================================

[core]
# ------------------------------------------------------------
# Device behavior
# ------------------------------------------------------------

# Seconds to ignore GPIO during boot
boot_ignore_time = 5.0

# Enable verbose logging
debug = false

# Host role (informational)
role = node

# ============================================================

[gpio]
# ------------------------------------------------------------
# Hardware pins (BCM numbering)
# ------------------------------------------------------------

shutdown_pin = 17
reset_pin = 27
safepower_pin = 22

# Optional power fail input
enable_power_fail = false
power_fail_pin = 23

bounce_time = 0.05

# ============================================================

[brownout]
# ------------------------------------------------------------
# Undervoltage protection
# ------------------------------------------------------------

enabled = true

# Seconds between checks
check_interval = 5

# Number of consecutive hits before shutdown
trigger_count = 3

# Auto shutdown on brownout
shutdown_on_trigger = true

# ============================================================

[watchdog]
# ------------------------------------------------------------
# systemd watchdog integration
# ------------------------------------------------------------

enabled = true

# Seconds between pings
interval = 20

# ============================================================

[storage]
# ------------------------------------------------------------
# Filesystem protection
# ------------------------------------------------------------

# Enable pre-shutdown I/O freeze
io_freeze = true

# Enforce read-only root
enforce_ro_root = true

# Auto harden fstab on boot
auto_harden_fstab = true

# ============================================================

[fleet]
# ------------------------------------------------------------
# Fleet connectivity
# ------------------------------------------------------------

enabled = true

# Beacon interval seconds
beacon_interval = 5

# Node API port
node_api_port = 8090

# Command agent port
cmd_agent_port = 8092

# Discovery UDP port
discovery_port = 8091

# ============================================================

[keys]
# ------------------------------------------------------------
# Device key management
# ------------------------------------------------------------

# Enable automatic rotation
auto_rotate = true

# Rotation interval hours
rotate_interval_hours = 24

# Allow remote rotate command
allow_remote_rotate = true

# ============================================================

[update]
# ------------------------------------------------------------
# Auto updater
# ------------------------------------------------------------

enabled = true

# Channel: stable | beta | main
channel = stable

# Update check interval (minutes)
check_interval_min = 30

# Restart service after update
restart_after_update = true

# ============================================================

[logging]
# ------------------------------------------------------------
# Logging behavior
# ------------------------------------------------------------

# Console log level
level = INFO

# Enable crash log capture
crash_capture = true

# Persistent logs directory (optional)
persistent_dir = /boot/pm-logs

# ============================================================

[health]
# ------------------------------------------------------------
# Boot health scoring
# ------------------------------------------------------------

enabled = true

# Score penalties
penalty_unclean_shutdown = 25
penalty_brownout = 20
penalty_fs_error = 30

# ============================================================
# END OF FILE
# ============================================================